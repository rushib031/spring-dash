package com.example.vuln_dashboard;

import org.springframework.web.bind.annotation.*;
import java.util.List;

@RestController
@RequestMapping("/api/vulnerabilities") // Good practice to use /api prefix
public class VulnerabilityController {

    private final VulnerabilityRepository repository;

    // Dependency Injection: Spring provides the repository here
    public VulnerabilityController(VulnerabilityRepository repository) {
        this.repository = repository;
    }

    @GetMapping
    public List<Vulnerability> getAll() {
        return repository.findAll(); // Fetches all rows from the DB
    }

    @GetMapping("/search")
    public List<Vulnerability> getBySeverity(@RequestParam String severity) {
        return repository.findBySeverity(severity);
    }

    @PostMapping
    public Vulnerability create(@RequestBody Vulnerability vuln) {
        return repository.save(vuln); // Saves a new row to the DB
    }

    @DeleteMapping("/{id}")
    public void deleteVulnerability(@PathVariable Long id) {
        repository.deleteById(id);
    }
}